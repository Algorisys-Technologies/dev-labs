@{
    bool isProcessComplete = @ViewBag.IsProcessComplete;
}
<input type="hidden" id="currentReportMOC" value="@ViewBag.currentMOC" />
<input type="hidden" id="pageTitle" value="@ViewBag.PageTitle" />
<input type="hidden" id="isProcessComplete" value="@isProcessComplete" />
<div class="container-fluid">
    <div class="row">

        <!--  Left Column -->


        <div class="col-sm-12">

            <div class="row mbottom10">
                <div class="col-sm-12">
                    <!-- Data Table -->
                    @if (isProcessComplete == true)
                    {
                        <section id="tableinfo" class="mtop20 ">
                            <div class="">
                                <table id="calculateProvisionTable" class="table table-striped table-bordered table-condensed" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="searchtext tblHeaderCenter">Customer</th>
                                            <th class="searchtext tblHeaderCenter">Customer</th>
                                            <th class="searchtext tblHeaderCenter">Outlet Category - Master</th>
                                            <th class="searchtext tblHeaderCenter">Basepack</th>
                                            <th class="searchtext tblHeaderCenter">Basepack</th>
                                            <th class="searchtext tblHeaderCenter">PMH Brand</th>
                                            <th class="searchtext tblHeaderCenter">PMH Brand</th>
                                            <th class="searchtext tblHeaderCenter">Sales SubCategory</th>
                                            <th class="searchtext tblHeaderCenter">Price List</th>
                                            <th class="searchtext tblHeaderCenter">HUL Outlet Code</th>
                                            <th class="searchtext tblHeaderCenter">HUL Outlet Code</th>
                                            <th class="searchtext tblHeaderCenter">Branch - Master</th>
                                            <th class="searchtext tblHeaderCenter">Branch - Master</th>
                                            <th class="searchtext tblHeaderCenter">MOC</th>
                                            <th class="searchtext tblHeaderCenter">Outlet Secondary Channel</th>
                                            <th class="searchtext tblHeaderCenter">Cluster Code</th>
                                            <th class="searchtext tblHeaderCenter">Cluster Code</th>
                                            <th class="searchtext tblHeaderCenter">Outlet Tier</th>
                                            <th class="searchtext tblHeaderCenter">Total Sales Value (INR)</th>
                                            <th class="searchtext tblHeaderCenter">Sales Return Value (INR)</th>
                                            <th class="searchtext tblHeaderCenter">Net Sales Value (INR)</th>
                                            <th class="searchtext tblHeaderCenter">Net Sales Qty (KGs)</th>
                                            <th class="searchtext tblHeaderCenter">Tax Code</th>
                                            <th class="searchtext tblHeaderCenter">State Code</th>
                                            <th class="searchtext tblHeaderCenter">Sales Tax</th>
                                            <th class="searchtext tblHeaderCenter">GSV</th>
                                            <th class="searchtext tblHeaderCenter">Chain Name</th>
                                            <th class="searchtext tblHeaderCenter">Group Name</th>
                                            <th class="searchtext tblHeaderCenter">Color / Non Color</th>
                                            <th class="searchtext tblHeaderCenter">On Invoice %</th>
                                            <th class="searchtext tblHeaderCenter">OffInvoice Monthly %</th>
                                            <th class="searchtext tblHeaderCenter">OffInvoice Qtrly %</th>
                                            <th class="searchtext tblHeaderCenter">HUGGIES PACKS %</th>
                                            <th class="searchtext tblHeaderCenter">ST% on Qtrly</th>
                                            <th class="searchtext tblHeaderCenter">ADD MARGIN %</th>
                                            <th class="searchtext tblHeaderCenter">HUGGIES PACKS</th>
                                            <th class="searchtext tblHeaderCenter">ST on Qtrly Provision Value</th>
                                            <th class="searchtext tblHeaderCenter">ADD MARGIN</th>
                                            <th class="searchtext tblHeaderCenter">OFF INVOICE MONTHLY</th>
                                            <th class="searchtext tblHeaderCenter">OFF INVOICE QTRLY</th>
                                            <th class="searchtext tblHeaderCenter">ON INVOICE VALUE</th>
                                            <th class="searchtext tblHeaderCenter">ON Invoice TOTAL</th>
                                            <th class="searchtext tblHeaderCenter">OFF INVOICE MONTHLY TOTAL</th>
                                            <th class="searchtext tblHeaderCenter">OFF INVOICE QTR TOTAL</th>
                                            <th class="searchtext tblHeaderCenter">Cluster</th>
                                            <th class="searchtext tblHeaderCenter">First Letter Brand</th>
                                            <th class="searchtext tblHeaderCenter">TOTSub Category</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                    @*<tfoot>
                                        <tr>
                                            <th class="searchtext">Customer Code</th>
                                            <th class="searchtext">Customer Name</th>
                                            <th class="searchtext">Outlet Category Master</th>
                                            <th class="searchtext">Basepack Code</th>
                                            <th class="searchtext">Basepack Name</th>
                                            <th class="searchtext">PMH Brand Code</th>
                                            <th class="searchtext">PMH Brand Name</th>
                                            <th class="searchtext">Sales Sub Cat</th>
                                            <th class="searchtext">Price List</th>
                                            <th class="searchtext">Hul Outlet Code</th>
                                            <th class="searchtext">Hul Outlet Name</th>
                                            <th class="searchtext">BranchCode</th>
                                            <th class="searchtext">BranchName</th>
                                            <th class="searchtext">MOC</th>
                                            <th class="searchtext">Outlet Secondary Channel</th>
                                            <th class="searchtext">Cluster Code</th>
                                            <th class="searchtext">Cluster Name</th>
                                            <th class="searchtext">Outlet Tier</th>
                                            <th class="searchtext">Total Sales Value</th>
                                            <th class="searchtext">Sales Return Value</th>
                                            <th class="searchtext">Net Sales Value</th>
                                            <th class="searchtext">Net Sales Qty</th>
                                            <th class="searchtext">Tax Code</th>
                                            <th class="searchtext">State Code</th>
                                            <th class="searchtext">Sales Tax</th>
                                            <th class="searchtext">GSV</th>
                                            <th class="searchtext">Chain Name</th>
                                            <th class="searchtext">Group Name</th>
                                            <th class="searchtext">Color / Non Color</th>
                                            <th class="searchtext">On Invoice %</th>
                                            <th class="searchtext">OffInvoice Monthly %</th>
                                            <th class="searchtext">OffInvoice Qtrly %</th>
                                            <th class="searchtext">HUGGIES PACKS %</th>
                                            <th class="searchtext">ST% on Qtrly</th>
                                            <th class="searchtext">ADD MARGIN %</th>
                                            <th class="searchtext">HUGGIES PACKS</th>
                                            <th class="searchtext">ST on Qtrly Provision Value</th>

                                            <th class="searchtext">ADD MARGIN</th>
                                            <th class="searchtext">OFF INVOICE MONTHLY</th>
                                            <th class="searchtext">OFF INVOICE QTRLY</th>
                                            <th class="searchtext">ON INVOICE VALUE</th>
                                            <th class="searchtext">ON Invoice TOTAL</th>
                                            <th class="searchtext">OFF INVOICE MONTHLY TOTAL</th>
                                            <th class="searchtext">OFF INVOICE QTR TOTAL</th>
                                            <th class="searchtext">Cluster</th>
                                            <th class="searchtext">First Letter Brand</th>
                                            <th class="searchtext">TOTSub Category</th>
                                        </tr>
                                    </tfoot>*@
                                </table>
                            </div>
                            <div class="clearfix"></div>
                        </section>
                    }
                </div>
            </div>

            <p class="mbottom10">&nbsp;</p>
            <p class="mbottom10">&nbsp;</p>

        </div>

    </div>
</div>

<script>


    var calculateProvisionTable_dtObj;
    $(document).ready(function () {

        $('.titlename').html($("#pageTitle").val());
        if ($("#isProcessComplete").val() == false) {
            bootbox.alert("Please Calculate Provision First!");
        }
        else {
            FillProvisionCalculationTable();
        }
    })


    function FillProvisionCalculationTable() {
        if (calculateProvisionTable_dtObj != undefined) {
            calculateProvisionTable_dtObj.destroy();
        }
        $('#calculateProvisionTable thead th.searchtext').each(function () {
            var title = $(this).text();
            $(this).html(title + '<br/><br/><input type="text" placeholder="Search ' + title + '" />');
        });

        calculateProvisionTable_dtObj = $('#calculateProvisionTable').DataTable({
            "processing": true,
            "serverSide": true,
            //"pageLength": 50
            //"bFilter": false,
            "info": true,
            //"stateSave": true,
            "lengthMenu": [[10, 20, 50, -1], [10, 20, 50, "All"]],
            "ajax": {
                "url": "@string.Format("{0}://{1}{2}", Request.Url.Scheme, Request.Url.Authority, Url.Content("~"))/CalculateProvision/AjaxGetMOCCalculationData?currentReportMOC=" + $("#currentReportMOC").val(),
                "type": "POST",
                "error": function (xhr, textStatus, errorThrown) {
                    callOnError(xhr, textStatus, errorThrown);
                }
            },
            "columns": [
                    { "data": "CustomerCode", "orderable": true },
                    { "data": "CustomerName", "orderable": true, "class": "leftaligncell" },
                    { "data": "OutletCategoryMaster", "orderable": true, "class": "leftaligncell" },
                    { "data": "BasepackCode", "orderable": true },
                    { "data": "BasepackName", "orderable": true, "class": "leftaligncell" },
                    { "data": "PMHBrandCode", "orderable": true },
                    { "data": "PMHBrandName", "orderable": true, "class": "leftaligncell" },
                    { "data": "SalesSubCat", "orderable": true, "class": "leftaligncell" },
                    { "data": "PriceList", "orderable": true },
                    { "data": "HulOutletCode", "orderable": true, "class": "leftaligncell" },
                    { "data": "HulOutletCodeName", "orderable": true, "class": "leftaligncell" },
                    { "data": "BranchCode", "orderable": true },
                    { "data": "BranchName", "orderable": true },
                    { "data": "MOC", "orderable": true },
                    { "data": "OutletSecChannel", "orderable": true },
                    { "data": "ClusterCode", "orderable": true },
                    { "data": "ClusterName", "orderable": true },
                    { "data": "OutletTier", "orderable": true },
                    { "data": "TotalSalesValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "SalesReturnValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "NetSalesValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "NetSalesQty", "orderable": true, "class": "rightaligncell" },
                    { "data": "TaxCode", "orderable": true },
                    { "data": "StateCode", "orderable": true },
                    { "data": "SalesTaxRate", "orderable": true },
                    { "data": "GSV", "orderable": true, "class": "rightaligncell" },
                    { "data": "ChainName", "orderable": true, "class": "leftaligncell" },
                    { "data": "GroupName", "orderable": true, "class": "leftaligncell" },
                    { "data": "ColorNonColor", "orderable": true },
                    { "data": "OnInvoiceRate", "orderable": true, "class": "rightaligncell" },
                    { "data": "OffInvoiceMthlyRate", "orderable": true, "class": "rightaligncell" },
                    { "data": "OffInvoiceQtrlyRate", "orderable": true, "class": "rightaligncell" },
                    { "data": "HuggiesPackPercentage", "orderable": true },
                    { "data": "ServiceTaxRate", "orderable": true },
                    { "data": "AdditionalMarginRate", "orderable": true },
                    { "data": "HuggiesPackMargin", "orderable": true },
                    { "data": "ServiceTax", "orderable": true },

                    { "data": "AdditionalMargin", "orderable": true },
                    { "data": "OffInvoiceMthlyValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "OffInvoiceQtrlyValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "OnInvoiceValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "OnInvoiceFinalValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "OffInvoiceMthlyFinalValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "OffInvoiceQtrlyFinalValue", "orderable": true, "class": "rightaligncell" },
                    { "data": "Cluster", "orderable": true },
                    { "data": "FirstLetterBrand", "orderable": true },
                    { "data": "TOTSubCategory", "orderable": true, "class": "leftaligncell" }
            ],
            "order": [[0, "asc"]],
            "scrollX": true,
            "scrollY": 400,
            "scroller": {
                loadingIndicator: true
            }
        });

        $("#calculateProvisionTable_filter").hide();
        // Apply the search
        calculateProvisionTable_dtObj.columns().every(function () {
            var that = this;

            $('input', this.header()).on('keyup change', function () {
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
        });
        setTimeout(function () {
            $('<a href="#" id="calculateProvision"><img class="downloadimg" src="/img/dashboard/Download_Excel.png" alt=""><span style="btn Color:blue;Padding:5px">Download</span></a>').insertBefore($("#calculateProvisionTable_length"))

        }, 10);
    }

    $(document).on("click", "#calculateProvision", function () {

        window.location = "/CalculateProvision/DownloadExcel?currentReportMOC=" + $("#currentReportMOC").val();

        //$.ajax({
        //    url: '/CalculateProvision/DownloadExcel',
        //    dataType: "json",
        //    type: "GET",
        //    contentType: 'application/json; charset=utf-8',
        //    async: true,
        //    cache: false,
        //    success: function (data) {

        //    }
        //});
    });

    $('#downloadAllFileFormat').parent("li").remove();

    $.ajax({
        url: "/Dashboard/LoadHeader",
        type: "get",
        data: "currentReportMOC=" + $("#currentReportMOC").val(),
        success: function (result) {
            $('.titleMonth').html(result.titleMonth);
            $('.currentdatetime').html(result.currentdatetime);
        }
    })
</script>
