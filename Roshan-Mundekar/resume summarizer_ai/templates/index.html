<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <title>ALGO-AI TECH</title>
    <style>
        /* Add some basic styling for pagination */
        .page-item.disabled .bg-gray-300 {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-info py-0 fixed-top">
        <a class="navbar-brand" href="/">ALGO-AI TECH</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="side-bar">
                <li class="active">
                    <a href="/">
                        <i class="fas fa-tachometer-alt fa-fw"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="/index">
                        <i class="fas fa-paste fa-fw"></i>
                        Resume summarizer
                    </a>
                </li>

                <li>
                    <a href="/email">
                        <i class="fas fa-file fa-fw"></i>
                        Email Summary
                    </a>
                </li>
            </ul>
            <!-- <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link px-3" href="#">
                        <i class="fas fa-cog fa-fw fa-lg"></i>
                        Settings
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-3" href="#">
                        <i class="fas fa-lock fa-fw fa-lg"></i>
                        Change Password
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-3" href="#">
                        <i class="fas fa-envelope fa-lg"></i>
                        <span class="badge badge-pill badge-danger position-absolute">5</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-3" href="#">
                        <i class="fas fa-bell fa-lg"></i>
                        <span class="badge badge-pill badge-warning position-absolute">1</span>
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav ml-5">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                        <img src="https://randomuser.me/api/portraits/men/94.jpg" alt="John Doe" width="40"
                            class="border mp-1 rounded-circle">
                        Roshan
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="#"><i class="fas fa-user fa-fw"></i> Profile</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt fa-fw"></i> Logout</a>
                    </div>
                </li>
            </ul> -->
        </div>
    </nav>

    <section class="content">
        <h1>All Resume</h1>

        <div class="card mt-4 mb-5">
            <div class="card-header">
                <div class="row align-items-center">
                    <div class="col">
                        <form class="form-inline">
                            <input type="text" id="searchInput" placeholder="Keyword"
                                class="form-control rounded-0 mr-2">
                        </form>
                    </div>
                    <div class="col-auto">
                        <a href="/create" class="btn btn-primary rounded-0 px-3">
                            <span class="rounded-pill">
                                <i class="fas fa-plus fa-fw"></i>
                            </span>
                            Add Resume Here
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered table mb-0">
                        <thead>
                            <tr>
                                <th>SN.</th>
                                <th>NAME</th>
                                <th width="120" class="text-center">Posted At</th>
                                <th width="150" class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer py-4">
                <nav>
                    <ul class="pagination justify-content-center" id="paginationControls">
                        <!-- Pagination buttons will be inserted here -->
                    </ul>
                </nav>
            </div>
        </div>
    </section>

    <!-- Pagination and Search Script -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <script>
        $(document).ready(function () {
            const tableData = {{ data | tojson
        }};
        let currentPage = 1;
        const rowsPerPage = 2;

        function displayTable(data, page) {
            const tableBody = $('#tableBody');
            tableBody.empty();

            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = data.slice(start, end);

            paginatedData.forEach(row => {
                const rowElement = `
                        <tr class="hover:bg-gray-100">
                            <td class="border px-4 py-2">${row[0]}</td>
                            <td class="border px-4 py-2">${row[1]}</td>
                            <td class="border px-4 py-2 text-center">${row[2]}</td>
                            <td class="border px-4 py-2 text-center">
                                <button class="bg-light text-gray-700 rounded-full p-1" onclick="viewDetails( ${row[0]})"><i class="fas fa-eye"></i></button>
                                <button class="bg-info text-white rounded-full p-1" onclick="viewDetails_botId( ${row[0]})"><i class="fas fa-edit"></i></button>
                                <button class="bg-danger text-white rounded-full p-1" onclick="confirmDelete(${row[0]})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                tableBody.append(rowElement);
            });

            setupPagination(data);
        }

        // Function to set up pagination controls
        function setupPagination(data) {
            const paginationControls = $('#paginationControls');
            paginationControls.empty();

            const totalPages = Math.ceil(data.length / rowsPerPage);

            // Previous button
            const prevBtn = `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>
            </li>
        `;
            paginationControls.append(prevBtn);

            // Page number buttons
            for (let i = 1; i <= totalPages; i++) {
                const isActive = currentPage === i ? 'active' : '';
                const btn = `
                <li class="page-item ${isActive}">
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
            `;
                paginationControls.append(btn);
            }

            // Next button
            const nextBtn = `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
            </li>
        `;
            paginationControls.append(nextBtn);
        }

        // Function to change pages
        window.changePage = function (page) {
            if (page < 1 || page > Math.ceil(tableData.length / rowsPerPage)) return; // Prevent out-of-bounds
            currentPage = page;
            displayTable(tableData, currentPage);
        };
        function filterTable() {
            const query = $('#searchInput').val().toLowerCase();
            const filteredData = tableData.filter(row => row[1].toLowerCase().includes(query));
            displayTable(filteredData, 1);
        }

        $('#searchInput').on('input', filterTable);
        displayTable(tableData, currentPage);
        });


        function confirmDelete(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Call the delete function if confirmed
                    deleteRecord(id);
                }
            });
        }
        
        function deleteRecord(id) {
            $.ajax({
                url: `/delete/${id}`,  // Adjust the URL as per your route
                type: 'DELETE',
                success: function(response) {
                    // Handle successful deletion (e.g., refresh table, show success message)
                    Swal.fire('Deleted!', response.message, 'success').then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = '/index'; // Redirect to home page
                        }
                    });
                    
                    // Refresh or update your table data here
                    displayTable(tableData, currentPage); // Assuming tableData holds the latest data
                },
                error: function(xhr, status, error) {
                    Swal.fire('Error!', 'Could not delete record.', 'error');
                }
            });
        }

        function viewDetails(recordId) {
            // Redirect to another page with the record ID in the URL
            window.location.href = `/view/${recordId}`;
        }

        function viewDetails_botId(botId) {
            // Redirect to another page with the record ID in the URL
            window.location.href = `/askbot/${botId}`;
        }

    </script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <script src="../static/js/custom.js"></script>
</body>

</html>